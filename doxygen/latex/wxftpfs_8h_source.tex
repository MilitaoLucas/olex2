\doxysection{wxftpfs.\+h}
\hypertarget{wxftpfs_8h_source}{}\label{wxftpfs_8h_source}\index{repository/wxftpfs.h@{repository/wxftpfs.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/******************************************************************************}}
\DoxyCodeLine{00002\ \textcolor{comment}{*\ Copyright\ (c)\ 2004-\/2011\ O.\ Dolomanov,\ OlexSys\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00003\ \textcolor{comment}{*\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00004\ \textcolor{comment}{*\ This\ file\ is\ part\ of\ the\ OlexSys\ Development\ Framework.\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{*\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00006\ \textcolor{comment}{*\ This\ source\ file\ is\ distributed\ under\ the\ terms\ of\ the\ licence\ located\ in\ \ \ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{*\ the\ root\ folder.\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00008\ \textcolor{comment}{******************************************************************************/}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#ifndef\ \_\_olx\_wxFtpFS\_H}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ \_\_olx\_wxFtpFS\_H}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}filesystem.h"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}url.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}wxzipfs.h"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}wx/protocol/ftp.h"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}ememstream.h"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{class\ }TwxFtpFileSystem\ :\ \textcolor{keyword}{public}\ AFileSystem\ \{}
\DoxyCodeLine{00019\ \ \ \mbox{\hyperlink{classTUrl}{TUrl}}\ Url;}
\DoxyCodeLine{00020\ \ \ wxFTP\ Ftp;}
\DoxyCodeLine{00021\ \ \ TwxZipFileSystem*\ ZipFS;}
\DoxyCodeLine{00022\ \ \ olxstr\ pwd;}
\DoxyCodeLine{00023\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00024\ \ \ olxstr\ NormaliseName(\textcolor{keyword}{const}\ olxstr\&\ name)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00025\ \ \ \ \ olxstr\ fn(TEFile::UnixPath(name));}
\DoxyCodeLine{00026\ \ \ \ \ fn\ =\ fn.StartsFrom(pwd)\ ?\ fn.SubStringFrom(pwd.Length())\ :\ fn;}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordflow}{return}\ fn.Trim(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{00028\ \ \ \}}
\DoxyCodeLine{00029\ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{structolx__object__ptr}{olx\_object\_ptr<IInputStream>}}\ \_DoOpenFile(\textcolor{keyword}{const}\ olxstr\&\ Source)\ \{}
\DoxyCodeLine{00030\ \ \ \ \ olxstr\ o\_src(NormaliseName(Source));}
\DoxyCodeLine{00031\ \ \ \ \ olxstr\ zip\_name\ =\ Source.SubStringFrom(Url.GetPath().Length()\ +\ 1);}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordflow}{if}\ (ZipFS\ !=\ 0\ \&\&\ ZipFS-\/>Exists(zip\_name)\ !=\ 0)\ \{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ZipFS-\/>OpenFile(zip\_name);}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classTOnProgress}{TOnProgress}}\ Progress;}
\DoxyCodeLine{00036\ \ \ \ \ Progress.SetMax(1);}
\DoxyCodeLine{00037\ \ \ \ \ Progress.SetPos(0);}
\DoxyCodeLine{00038\ \ \ \ \ Progress.SetAction(olxstr(\textcolor{stringliteral}{"{}Downloading\ "{}})\ <<\ o\_src);}
\DoxyCodeLine{00039\ \ \ \ \ OnProgress.Enter(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{structolx__object__ptr}{olx\_object\_ptr<wxInputStream>}}\ is;}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ olxstr\ src(o\_src);}
\DoxyCodeLine{00043\ \ \ \ \ \ \ src.Replace(\textcolor{charliteral}{'\ '},\ \textcolor{stringliteral}{"{}\%20"{}});}
\DoxyCodeLine{00044\ \ \ \ \ \ \ is\ =\ wxOpenFile(src);}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\ !=\ 0)\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ Progress.SetMax(is-\/>GetLength());}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ OnProgress.Execute(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00049\ \ \ \ \ \}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{catch}\ (...)\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\ ==\ 0)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classTFunctionFailedException}{TFunctionFailedException}}(\_\_OlxSourceInfo,\ olxstr(\textcolor{stringliteral}{"{}NULL\ handle\ for\ '"{}})\ <<\ o\_src\ <<\ \textcolor{charliteral}{'\(\backslash\)''});}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00057\ \ \ \ \ \}}
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{structolx__object__ptr}{olx\_object\_ptr<TEMemoryStream>}}\ ms\ =\ \textcolor{keyword}{new}\ TEMemoryStream();}
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{structolx__array__ptr}{olx\_array\_ptr<char>}}\ bf(1024\ *\ 64);}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ is-\/>Read(bf,\ 1024\ *\ 64);}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (is-\/>LastRead()\ !=\ 0)\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ ms-\/>Write(bf,\ is-\/>LastRead());}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Progress.GetMax()\ >\ 0)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ Progress.SetPos(ms-\/>GetPosition());}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ OnProgress.Execute(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Break)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ is-\/>Read(bf,\ 1024\ *\ 64);}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ ms-\/>SetPosition(0);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ Progress.SetAction(\textcolor{stringliteral}{"{}Download\ complete"{}});}
\DoxyCodeLine{00075\ \ \ \ \ \ \ Progress.SetPos(0);}
\DoxyCodeLine{00076\ \ \ \ \ \ \ OnProgress.Exit(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ms.release();}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{catch}\ (...)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ Progress.SetAction(\textcolor{stringliteral}{"{}Download\ failed"{}});}
\DoxyCodeLine{00081\ \ \ \ \ \ \ Progress.SetPos(0);}
\DoxyCodeLine{00082\ \ \ \ \ \ \ OnProgress.Execute(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00083\ \ \ \ \ \ \ OnProgress.Exit(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00085\ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \_DoesExist(\textcolor{keyword}{const}\ olxstr\&\ DN,\ \textcolor{keywordtype}{bool})\ \{}
\DoxyCodeLine{00089\ \ \ \ \ olxstr\ fn(NormaliseName(DN).u\_str());}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ (Index\ !=\ 0)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Index-\/>GetRoot().FindByFullName(fn)\ !=\ 0;}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{return}\ Ftp.FileExists(fn.u\_str());}
\DoxyCodeLine{00094\ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \_DoDelFile(\textcolor{keyword}{const}\ olxstr\&\ FN)\ \{\ \ \textcolor{comment}{//\ to\ dangerous}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{return}\ Ftp.RmFile(NormaliseName(FN).u\_str());}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \_DoDelDir(\textcolor{keyword}{const}\ olxstr\&\ DN)\ \{\ \ \textcolor{comment}{//\ too\ dangerous}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{return}\ Ftp.RmDir(NormaliseName(DN).u\_str());}
\DoxyCodeLine{00101\ \ \ \}}
\DoxyCodeLine{00102\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \_DoAdoptFile(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTFSItem}{TFSItem}}\&\ src)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{structolx__object__ptr}{olx\_object\_ptr<IInputStream>}}\ is;}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ is\ =\ src.GetIndexFS().OpenFile(src.GetIndexFS().GetBase()\ +\ src.GetFullName());}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\ !=\ 0)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ AdoptStream(*is.release(),\ TEFile::UnixPath(src.GetFullName()));}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classTExceptionBase}{TExceptionBase}}\&\ exc)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classTFunctionFailedException}{TFunctionFailedException}}(\_\_OlxSourceInfo,\ exc);}
\DoxyCodeLine{00112\ \ \ \ \ \}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \_DoAdoptStream(\mbox{\hyperlink{classIInputStream}{IInputStream}}\&\ in,\ \textcolor{keyword}{const}\ olxstr\&\ as)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ olxstr\ rel\_path(NormaliseName(as));}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ \ \ \ OnAdoptFile-\/>Execute(\ this,\ \&F\_\_N);}}
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{classTOnProgress}{TOnProgress}}\ Progress;}
\DoxyCodeLine{00120\ \ \ \ \ Progress.SetMax(1);}
\DoxyCodeLine{00121\ \ \ \ \ Progress.SetPos(0);}
\DoxyCodeLine{00122\ \ \ \ \ Progress.SetAction(olxstr(\textcolor{stringliteral}{"{}Uploading\ "{}})\ <<\ rel\_path);}
\DoxyCodeLine{00123\ \ \ \ \ OnProgress.Enter(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ Progress.SetMax(in.GetSize());}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{comment}{//TStrList\ path\_toks;}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ ind\ =\ rel\_path.LastIndexOf(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{00129\ \ \ \ \ \ \ olxstr\ path\ =\ (ind\ !=\ InvalidIndex\ ?\ rel\_path.SubStringTo(ind)\ :\ EmptyString());}
\DoxyCodeLine{00130\ \ \ \ \ \ \ olxstr\ fn\ =\ (ind\ ==\ InvalidIndex\ ?\ rel\_path\ :\ rel\_path.SubStringFrom(ind\ +\ 1));}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ depth\ =\ 0;}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!path.IsEmpty()\ \&\&\ !Ftp.FileExists(path.u\_str()))\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!NewDir(path))}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classTFunctionFailedException}{TFunctionFailedException}}(\_\_OlxSourceInfo,\ olxstr(\textcolor{stringliteral}{"{}Mkdir\ \(\backslash\)'"{}})\ <<\ path\ <<\ \textcolor{charliteral}{'\(\backslash\)''});}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ \mbox{\hyperlink{structolx__object__ptr}{olx\_object\_ptr<wxOutputStream>}}\ out\ =\ Ftp.GetOutputStream(rel\_path.u\_str());}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (out\ ==\ 0)\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classTFunctionFailedException}{TFunctionFailedException}}(\_\_OlxSourceInfo,\ \textcolor{stringliteral}{"{}could\ not\ open\ output\ stream"{}});}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bf\_sz\ =\ 64\ *\ 1024;}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \mbox{\hyperlink{structolx__array__ptr}{olx\_array\_ptr<char>}}\ bf(bf\_sz);}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ read\ =\ 0;}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ ((read\ =\ in.SafeRead(\&bf,\ bf\_sz))\ >\ 0)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Break)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ Ftp.RmFile(rel\_path.u\_str());}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ out-\/>Write(\&bf,\ read);}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ Progress.SetPos(in.GetPosition());}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ OnProgress.Execute(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ Progress.SetAction(\textcolor{stringliteral}{"{}Upload\ complete"{}});}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ Progress.SetPos(0);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ OnProgress.Exit(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{keywordflow}{catch}\ (...)\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ Progress.SetAction(\textcolor{stringliteral}{"{}Upload\ failed"{}});}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ Progress.SetPos(0);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ OnProgress.Execute(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ OnProgress.Exit(\textcolor{keyword}{this},\ \&Progress);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00164\ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{catch}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classTExceptionBase}{TExceptionBase}}\&\ exc)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classTFunctionFailedException}{TFunctionFailedException}}(\_\_OlxSourceInfo,\ exc);}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \_DoNewDir(\textcolor{keyword}{const}\ olxstr\&\ DN)\ \{}
\DoxyCodeLine{00172\ \ \ \ \ olxstr\ norm\_path(NormaliseName(DN));}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{if}\ (norm\_path.FirstIndexOf(\textcolor{charliteral}{'/'})\ !=\ InvalidIndex)\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ TStrList\ toks(norm\_path,\ \textcolor{charliteral}{'/'});}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ toks.Count();\ i++)\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!Ftp.FileExists(toks[i].u\_str()))}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!Ftp.MkDir(toks[i].u\_str()))\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!Ftp.ChDir(toks[i].u\_str()))\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ toks.Count();\ i++)\ \{\ \textcolor{comment}{//\ restore\ the\ level}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!Ftp.ChDir(wxT(\textcolor{stringliteral}{"{}.."{}})))\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordflow}{return}\ Ftp.MkDir(norm\_path.u\_str());}
\DoxyCodeLine{00192\ \ \ \}}
\DoxyCodeLine{00193\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00194\ \ \ TwxFtpFileSystem(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTUrl}{TUrl}}\&\ url,\ TwxZipFileSystem*\ zipFS\ =\ 0)}
\DoxyCodeLine{00195\ \ \ \ \ :\ Url(url)}
\DoxyCodeLine{00196\ \ \ \{}
\DoxyCodeLine{00197\ \ \ \ \ Access\ =\ afs\_FullAccess;}
\DoxyCodeLine{00198\ \ \ \ \ Ftp.SetUser(url.GetUser().u\_str());}
\DoxyCodeLine{00199\ \ \ \ \ Ftp.SetPassword(url.GetPassword().u\_str());}
\DoxyCodeLine{00200\ \ \ \ \ Ftp.SetBinary();}
\DoxyCodeLine{00201\ \ \ \ \ ZipFS\ =\ zipFS;}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Ftp.Connect((url.HasProxy()\ ?\ url.GetProxy().GetFullHost()\ :\ url.GetHost()).u\_str()))\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classTFunctionFailedException}{TFunctionFailedException}}(\_\_OlxSourceInfo,\ \textcolor{stringliteral}{"{}connection\ failed"{}});}
\DoxyCodeLine{00204\ \ \ \ \ \}}
\DoxyCodeLine{00205\ \ \ \ \ SetBase(url.GetPath());}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordflow}{if}\ (!url.GetPath().IsEmpty())\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!Exists(url.GetPath()))\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ NewDir(url.GetPath());}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ ChangeDir(url.GetPath());}
\DoxyCodeLine{00211\ \ \ \ \ \ \ pwd\ =\ url.GetPath();}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \}}
\DoxyCodeLine{00214\ \ \ \textcolor{keyword}{virtual}\ \string~TwxFtpFileSystem()\ \{\}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \textcolor{comment}{//\ saves\ stream\ to\ a\ temporary\ file}}
\DoxyCodeLine{00217\ \ \ \mbox{\hyperlink{structolx__object__ptr}{olx\_object\_ptr<TEFile>}}\ SaveFile(\textcolor{keyword}{const}\ olxstr\&\ fn);}
\DoxyCodeLine{00218\ \ \ \textcolor{comment}{//\ zip\ is\ as\ primary\ source\ of\ the\ files,\ if\ a\ file\ is\ not\ in\ the\ zip\ -\/\ Url\ is\ used}}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordtype}{void}\ SetZipFS(TwxZipFileSystem*\ zipFS)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{if}\ (ZipFS\ !=\ 0)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ ZipFS;}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \ \ ZipFS\ =\ zipFS;}
\DoxyCodeLine{00224\ \ \ \}}
\DoxyCodeLine{00225\ \ \ \textcolor{keyword}{virtual}\ wxInputStream*\ wxOpenFile(\textcolor{keyword}{const}\ olxstr\&\ Source)\ \{\ \textcolor{keywordflow}{return}\ Ftp.GetInputStream(Source.u\_str());\ \}}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordtype}{bool}\ ChangeDir(\textcolor{keyword}{const}\ olxstr\&\ DN)\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{if}\ (Ftp.ChDir(DN.u\_str()))\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ pwd\ =\ TEFile::UnixPath(Ftp.Pwd().wx\_str());}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00230\ \ \ \ \ \}}
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00232\ \ \ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \};}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
